### Variables
@host = http://127.0.0.1:8000
@email = test.user@example.com
@password = StrongPassword123!

### 1. Register a new user
POST {{host}}/auth/register
Content-Type: application/json

{
    "email_address": "{{email}}",
    "password": "{{password}}"
}

### 2. Login to obtain Access Token
# @name login
POST {{host}}/auth/login
Content-Type: application/x-www-form-urlencoded

username={{email}}&password={{password}}

### 3. Capture Token from Login Response
@token = {{login.response.body.access_token}}

### 4. Verify Current User Profile (Auth Check)
GET {{host}}/auth/me
Authorization: Bearer {{token}}

### 5. Create First Receipt (Protected)
# @name createReceipt1
POST {{host}}/receipts/
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "merchant_name": "Rami Levy",
    "total_amount": 150.50,
    "tax_amount": 25.50,
    "receipt_date": "2026-02-27"
}

### 6. Create Second Receipt (Protected)
POST {{host}}/receipts/
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "merchant_name": "KSP",
    "total_amount": 4200.00,
    "tax_amount": 714.00,
    "receipt_date": "2026-02-26"
}

### 7. Get All My Receipts (Filtered by User ID)
GET {{host}}/receipts/
Authorization: Bearer {{token}}

### 8. Get Specific Receipt
@receiptId = {{createReceipt1.response.body.id}}
GET {{host}}/receipts/{{receiptId}}
Authorization: Bearer {{token}}

### 9. Update Receipt
PUT {{host}}/receipts/{{receiptId}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "merchant_name": "Rami Levy Hashikma",
    "total_amount": 160.00,
    "tax_amount": 27.00,
    "receipt_date": "2026-02-27"
}

### 10. Delete Receipt
DELETE {{host}}/receipts/{{receiptId}}
Authorization: Bearer {{token}}

### 11. Security Test: Unauthorized Access (Should return 401)
GET {{host}}/receipts/